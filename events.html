<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Events - Bartending2U</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="styles.css" />
</head>
<body>
    <header class="top-bar">
        <div class="top-bar__inner">
            <div class="brand">
                <img src="IMG_9047.png" alt="Bartending2U logo" />
                <div class="brand__text">
                    <span class="brand__subtitle">Bartending2U</span>
                    <span class="brand__title">Scheduling Suite</span>
                </div>
            </div>

            <button
                class="mobile-nav-toggle"
                id="mobileNavToggle"
                type="button"
                aria-label="Toggle navigation"
                aria-expanded="false"
                data-mobile-nav-toggle
            >
                <span class="mobile-nav-toggle__icon" aria-hidden="true">☰</span>
                <span class="sr-only">Toggle navigation</span>
            </button>

            <nav class="nav-links" id="primaryNav">
                <a class="nav-link" href="index.html">Dashboard</a>
                <a class="nav-link active" href="events.html">Events</a>
                <a class="nav-link" href="leads.html">Leads</a>
                <a class="nav-link" href="employees.html">Employees</a>
                <a class="nav-link" href="calendar.html">Calendar</a>
                <a class="nav-link" href="settings.html">Settings</a>
            </nav>

            <a class="cta-button" href="#new-event">+ New Event</a>
        </div>
    </header>

    <main class="page-content">
        <section class="page-header">
            <div>
                <p class="page-eyebrow">Events</p>
                <h1 class="page-title">Booked experiences & proposals</h1>
                <p class="lead-text">Glance through every celebration, from contracted events to pending tastings, and manage staffing in one place.</p>
            </div>
            <div class="hero-actions">
                <a class="button primary" href="#new-event" data-subsection-target="new-event">Log new booking</a>
                <a class="secondary-link" href="calendar.html">Sync with calendar →</a>
            </div>
        </section>

        <section id="event-pipeline" class="content-card" data-subsection="Event pipeline">
            <div class="card-header">
                <div>
                    <h2 class="card-title">Event pipeline</h2>
                    <p class="card-subtitle">Filter the engagements you care about and track readiness at a glance.</p>
                </div>
            </div>
            <div class="tab-bar">
                <button class="tab active" type="button" data-filter="all">All</button>
                <button class="tab" type="button" data-filter="confirmed">Confirmed</button>
                <button class="tab" type="button" data-filter="pending">Pending</button>
                <button class="tab" type="button" data-filter="drafts">Drafts</button>
            </div>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Event</th>
                            <th>Date</th>
                            <th>Location</th>
                            <th>Package</th>
                            <th>Status</th>
                            <th>Staffing</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td data-label="Event">Corporate Party</td>
                            <td data-label="Date">Oct 5, 2025</td>
                            <td data-label="Location">Downtown Houston</td>
                            <td data-label="Package">Signature Cocktail Bar</td>
                            <td data-label="Status"><span class="badge success">Confirmed</span></td>
                            <td data-label="Staffing"><span class="badge success">Fully staffed</span></td>
                            <td class="table-actions" data-label="Actions">
                                <a class="card-action" href="#">View</a>
                                <a class="card-action" href="#">Staff</a>
                            </td>
                        </tr>
                        <tr>
                            <td data-label="Event">Wedding Reception</td>
                            <td data-label="Date">Oct 15, 2025</td>
                            <td data-label="Location">The Grand Hall</td>
                            <td data-label="Package">Premium Mixology</td>
                            <td data-label="Status"><span class="badge warning">Awaiting deposit</span></td>
                            <td data-label="Staffing"><span class="badge warning">Needs 2 bartenders</span></td>
                            <td class="table-actions" data-label="Actions">
                                <a class="card-action" href="#">Send reminder</a>
                                <a class="card-action" href="#">Assign</a>
                            </td>
                        </tr>
                        <tr>
                            <td data-label="Event">Holiday Gala</td>
                            <td data-label="Date">Nov 30, 2025</td>
                            <td data-label="Location">Skyline Ballroom</td>
                            <td data-label="Package">Craft Experience</td>
                            <td data-label="Status"><span class="badge danger">Contract overdue</span></td>
                            <td data-label="Staffing"><span class="badge warning">Partial coverage</span></td>
                            <td class="table-actions" data-label="Actions">
                                <a class="card-action" href="#">Follow up</a>
                                <a class="card-action" href="#">View notes</a>
                            </td>
                        </tr>
                        <tr>
                            <td data-label="Event">Mixology Workshop</td>
                            <td data-label="Date">Dec 3, 2025</td>
                            <td data-label="Location">Private Residence</td>
                            <td data-label="Package">Interactive Class</td>
                            <td data-label="Status"><span class="badge success">Confirmed</span></td>
                            <td data-label="Staffing"><span class="badge success">Ready</span></td>
                            <td class="table-actions" data-label="Actions">
                                <a class="card-action" href="#">Checklist</a>
                                <a class="card-action" href="#">Prep sheet</a>
                            </td>
                        </tr>
                    </tbody>
                    <tbody id="eventsTableBody"></tbody>
                </table>
            </div>
        </section>

        <section id="new-event" class="content-card" data-subsection="Create new event">
            <div class="card-header">
                <div>
                    <h2 class="card-title">Create new event</h2>
                    <p class="card-subtitle">Capture the essentials, assign talent, and keep clients delighted.</p>
                    <p class="form-mode-indicator" id="eventFormModeIndicator" aria-live="polite"></p>
                </div>
            </div>
            <form id="eventForm">
                <input id="eventId" name="id" type="hidden" />
                <div class="form-grid">
                    <div class="form-field">
                        <label for="eventName">Event name</label>
                        <input id="eventName" name="name" type="text" placeholder="E.g. Winter Soirée" required />
                    </div>
                    <div class="form-field">
                        <label for="eventDate">Date</label>
                        <input id="eventDate" name="date" type="date" required />
                    </div>
                    <div class="form-field">
                        <label for="eventTime">Start time</label>
                        <input id="eventTime" name="time" type="time" />
                    </div>
                    <div class="form-field">
                        <label for="eventLocation">Location</label>
                        <input id="eventLocation" name="location" type="text" placeholder="Venue or address" />
                    </div>
                    <div class="form-field">
                        <label for="eventPackage">Service package</label>
                        <select id="eventPackage" name="package" required>
                            <option value="" selected disabled>Select package</option>
                            <option>Signature Cocktail Bar</option>
                            <option>Premium Mixology</option>
                            <option>Interactive Workshop</option>
                            <option>Custom Experience</option>
                        </select>
                    </div>
                    <div class="form-field">
                        <label for="guestCount">Guest count</label>
                        <input id="guestCount" name="guestCount" type="number" min="0" placeholder="Expected attendees" />
                    </div>
                    <div class="form-field">
                        <label for="eventPayout">Estimated payout (USD)</label>
                        <input id="eventPayout" name="payout" type="number" min="0" step="50" placeholder="0" />
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-field">
                        <label for="eventStatus">Event status</label>
                        <select id="eventStatus" name="status" required>
                            <option value="" disabled>Select status</option>
                            <option value="Confirmed" data-level="success" selected>Confirmed</option>
                            <option value="Awaiting deposit" data-level="warning">Awaiting deposit</option>
                            <option value="Contract overdue" data-level="danger">Contract overdue</option>
                            <option value="Proposal sent" data-level="info">Proposal sent</option>
                            <option value="Draft" data-level="neutral">Draft</option>
                        </select>
                    </div>
                    <div class="form-field">
                        <label for="eventStaffing">Staffing status</label>
                        <select id="eventStaffing" name="staffingStatus" required>
                            <option value="" disabled>Select staffing</option>
                            <option value="Fully staffed" data-level="success" selected>Fully staffed</option>
                            <option value="Ready" data-level="success">Ready</option>
                            <option value="Needs 1 bartender" data-level="warning">Needs 1 bartender</option>
                            <option value="Needs 2 bartenders" data-level="warning">Needs 2 bartenders</option>
                            <option value="Unassigned" data-level="danger">Unassigned</option>
                        </select>
                    </div>
                </div>
                <div class="form-field">
                    <label for="eventNotes">Notes & client preferences</label>
                    <textarea id="eventNotes" name="notes" placeholder="Share tastings, specialty cocktails, or logistics."></textarea>
                </div>
                <div class="table-actions" style="justify-content: flex-end;">
                    <button class="button ghost" type="reset">Clear</button>
                    <button class="button primary" type="submit">Save event</button>
                </div>
            </form>
        </section>
    </main>

    <footer class="app-footer">© 2025 Bartending2U. Crafted for seamless event coordination.</footer>

    <script src="scripts.js"></script>
    <script src="storage.js"></script>
    <script>
        const navToggle = document.getElementById('mobileNavToggle');
        const nav = document.getElementById('primaryNav');

        if (navToggle && nav) {
            navToggle.addEventListener('click', () => {
                nav.classList.toggle('open');
            });
        }

        const store = window.B2UStore;
        const tableBody = document.getElementById('eventsTableBody');
        const form = document.getElementById('eventForm');
        const tabs = document.querySelectorAll('.tab');
        const submitButton = form ? form.querySelector('[type="submit"]') : null;
        const modeIndicator = document.getElementById('eventFormModeIndicator');
        const hiddenIdField = document.getElementById('eventId');
        let activeFilter = 'all';
        let editingEventId = null;

        const defaultStatusValue = 'Confirmed';
        const defaultStaffingValue = 'Fully staffed';

        function formatDate(dateStr, timeStr) {
            if (!dateStr) {
                return 'Date TBC';
            }

            const date = new Date(`${dateStr}T${timeStr || '12:00'}`);
            if (Number.isNaN(date.getTime())) {
                return 'Date TBC';
            }

            return new Intl.DateTimeFormat('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric',
                hour: timeStr ? 'numeric' : undefined,
                minute: timeStr ? '2-digit' : undefined,
            }).format(date);
        }

        function formatCurrency(amount) {
            if (!amount && amount !== 0) {
                return '$0';
            }

            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                maximumFractionDigits: 0,
            }).format(amount);
        }

        function createBadge(text, level) {
            const badge = document.createElement('span');
            badge.className = `badge ${level || 'neutral'}`;
            badge.textContent = text;
            return badge;
        }

        function getEventTimestamp(event) {
            if (!event || !event.date) {
                return Number.MAX_SAFE_INTEGER;
            }

            const timestamp = new Date(`${event.date}T${event.time || '00:00'}`).getTime();
            return Number.isNaN(timestamp) ? Number.MAX_SAFE_INTEGER : timestamp;
        }

        function filterEvents(events) {
            switch (activeFilter) {
                case 'confirmed':
                    return events.filter((event) => event.statusLevel === 'success');
                case 'pending':
                    return events.filter((event) => event.statusLevel !== 'success');
                case 'drafts':
                    return events.filter((event) => (event.status || '').toLowerCase().includes('draft'));
                default:
                    return events;
            }
        }

        function renderEvents() {
            if (!tableBody) {
                return;
            }

            tableBody.innerHTML = '';

            if (!store) {
                const row = document.createElement('tr');
                const cell = document.createElement('td');
                cell.colSpan = 7;
                cell.className = 'empty-state';
                cell.textContent = 'Storage service unavailable. Refresh to retry.';
                row.appendChild(cell);
                tableBody.appendChild(row);
                return;
            }

            const events = filterEvents(
                store
                    .getEvents()
                    .slice()
                    .sort((a, b) => getEventTimestamp(a) - getEventTimestamp(b))
            );

            if (events.length === 0) {
                const row = document.createElement('tr');
                const cell = document.createElement('td');
                cell.colSpan = 7;
                cell.className = 'empty-state';
                cell.textContent = 'No events match this filter yet. Save one below to get started.';
                row.appendChild(cell);
                tableBody.appendChild(row);
                return;
            }

            events.forEach((event) => {
                const row = document.createElement('tr');

                const nameCell = document.createElement('td');
                nameCell.textContent = event.name;

                const dateCell = document.createElement('td');
                dateCell.textContent = formatDate(event.date, event.time);

                const locationCell = document.createElement('td');
                locationCell.textContent = event.location || 'Location TBC';

                const packageCell = document.createElement('td');
                const packageParts = [];
                if (event.package) {
                    packageParts.push(event.package);
                }
                if (event.guestCount) {
                    packageParts.push(`${event.guestCount} guests`);
                }
                if (event.payout) {
                    packageParts.push(formatCurrency(event.payout));
                }
                packageCell.textContent = packageParts.join(' · ') || 'Package TBC';

                const statusCell = document.createElement('td');
                statusCell.appendChild(createBadge(event.status || 'Pending', event.statusLevel));

                const staffingCell = document.createElement('td');
                staffingCell.appendChild(createBadge(event.staffingStatus || 'Unassigned', event.staffingLevel));

                const actionsCell = document.createElement('td');
                actionsCell.className = 'table-actions';

                const viewLink = document.createElement('a');
                viewLink.className = 'card-action';
                viewLink.href = '#new-event';
                viewLink.textContent = 'View';

                const editButton = document.createElement('button');
                editButton.type = 'button';
                editButton.className = 'card-action link-button';
                editButton.dataset.editEvent = event.id;
                editButton.textContent = 'Modify';

                const removeButton = document.createElement('button');
                removeButton.type = 'button';
                removeButton.className = 'card-action link-button';
                removeButton.dataset.removeEvent = event.id;
                removeButton.textContent = 'Remove';

                actionsCell.appendChild(viewLink);
                actionsCell.appendChild(editButton);
                actionsCell.appendChild(removeButton);

                row.appendChild(nameCell);
                row.appendChild(dateCell);
                row.appendChild(locationCell);
                row.appendChild(packageCell);
                row.appendChild(statusCell);
                row.appendChild(staffingCell);
                row.appendChild(actionsCell);
                tableBody.appendChild(row);
            });
        }

        if (tabs.length) {
            tabs.forEach((tab) => {
                tab.addEventListener('click', () => {
                    tabs.forEach((button) => button.classList.remove('active'));
                    tab.classList.add('active');
                    activeFilter = tab.dataset.filter || 'all';
                    renderEvents();
                });
            });
        }

        if (tableBody) {
            tableBody.addEventListener('click', (event) => {
                const removeTarget = event.target.closest('[data-remove-event]');
                const editTarget = event.target.closest('[data-edit-event]');

                if (removeTarget && store) {
                    store.removeEvent(removeTarget.dataset.removeEvent);
                    renderEvents();
                    if (editingEventId === removeTarget.dataset.removeEvent) {
                        exitEditMode();
                        applyDefaultSelects();
                    }
                    return;
                }

                if (editTarget && store) {
                    const existingEvent = store
                        .getEvents()
                        .find((item) => item.id === editTarget.dataset.editEvent);

                    if (!existingEvent) {
                        return;
                    }

                    enterEditMode(existingEvent);
                }
            });
        }

        function applyDefaultSelects() {
            if (!form) {
                return;
            }

            if (form.eventStatus) {
                form.eventStatus.value = defaultStatusValue;
            }
            if (form.eventStaffing) {
                form.eventStaffing.value = defaultStaffingValue;
            }
        }

        function ensureOption(select, value, level) {
            if (!select || value === undefined || value === null || value === '') {
                return;
            }

            const option = Array.from(select.options || []).find((opt) => opt.value === value);
            if (option) {
                if (level && option.dataset) {
                    option.dataset.level = level;
                }
                select.value = value;
                return;
            }

            const newOption = document.createElement('option');
            newOption.value = value;
            newOption.textContent = value;
            if (level) {
                newOption.dataset.level = level;
            }
            select.appendChild(newOption);
            select.value = value;
        }

        function updateModeIndicator(message) {
            if (!modeIndicator) {
                return;
            }

            modeIndicator.textContent = message || '';
        }

        function exitEditMode() {
            editingEventId = null;
            if (hiddenIdField) {
                hiddenIdField.value = '';
            }
            if (submitButton) {
                submitButton.textContent = 'Save event';
            }
            if (form) {
                form.dataset.mode = 'create';
            }
            updateModeIndicator('');
        }

        function enterEditMode(eventData) {
            if (!form) {
                return;
            }

            editingEventId = eventData.id;
            if (hiddenIdField) {
                hiddenIdField.value = eventData.id;
            }

            form.dataset.mode = 'edit';

            if (form.eventName) {
                form.eventName.value = eventData.name || '';
            }
            if (form.eventDate) {
                form.eventDate.value = eventData.date || '';
            }
            if (form.eventTime) {
                form.eventTime.value = eventData.time || '';
            }
            if (form.eventLocation) {
                form.eventLocation.value = eventData.location || '';
            }
            if (form.eventPackage) {
                ensureOption(form.eventPackage, eventData.package);
            }
            if (form.guestCount) {
                form.guestCount.value = eventData.guestCount != null ? eventData.guestCount : '';
            }
            if (form.eventPayout) {
                form.eventPayout.value = eventData.payout != null ? eventData.payout : '';
            }
            if (form.eventStatus) {
                ensureOption(form.eventStatus, eventData.status, eventData.statusLevel);
            }
            if (form.eventStaffing) {
                ensureOption(form.eventStaffing, eventData.staffingStatus, eventData.staffingLevel);
            }
            if (form.eventNotes) {
                form.eventNotes.value = eventData.notes || '';
            }

            if (submitButton) {
                submitButton.textContent = 'Update event';
            }

            const nameText = eventData.name ? `Editing "${eventData.name}"` : 'Editing existing event';
            updateModeIndicator(nameText);
            if (typeof window !== 'undefined') {
                window.location.hash = '#new-event';
            }
        }

        if (form && store) {
            form.addEventListener('submit', (event) => {
                event.preventDefault();

                const formData = new FormData(form);
                const statusSelect = form.eventStatus;
                const staffingSelect = form.eventStaffing;
                const statusOption = statusSelect ? statusSelect.options[statusSelect.selectedIndex] : null;
                const staffingOption = staffingSelect ? staffingSelect.options[staffingSelect.selectedIndex] : null;

                const eventPayload = {
                    name: (formData.get('name') || '').trim() || 'Untitled event',
                    date: formData.get('date') || '',
                    time: formData.get('time') || '',
                    location: (formData.get('location') || '').trim(),
                    package: formData.get('package') || '',
                    guestCount: Number(formData.get('guestCount') || 0),
                    payout: Number(formData.get('payout') || 0),
                    status: formData.get('status') || (statusSelect ? statusSelect.value : 'Draft'),
                    statusLevel: statusOption ? statusOption.dataset.level : undefined,
                    staffingStatus:
                        formData.get('staffingStatus') || (staffingSelect ? staffingSelect.value : 'Unassigned'),
                    staffingLevel: staffingOption ? staffingOption.dataset.level : undefined,
                    notes: (formData.get('notes') || '').trim(),
                };

                if (editingEventId) {
                    store.updateEvent(editingEventId, eventPayload);
                } else {
                    store.addEvent(eventPayload);
                }

                form.reset();
                exitEditMode();
                applyDefaultSelects();
                renderEvents();
            });

            form.addEventListener('reset', () => {
                const resetHandler = () => {
                    exitEditMode();
                    applyDefaultSelects();
                };

                if (typeof window !== 'undefined' && window.requestAnimationFrame) {
                    window.requestAnimationFrame(resetHandler);
                } else {
                    resetHandler();
                }
            });
        }

        renderEvents();
    </script>
    <script src="app.js"></script>
</body>
</html>
